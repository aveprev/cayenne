<html>
  <head>
    <title>Cayenne Documentation - Command-Line Tutorial</title>
    <style type="text/css">@import "../../../../style.css";</style>
  </head>
<body>
  <div class="header">
    <div style="float: left;"><a href="http://objectstyle.org/cayenne/"><img src="../../../../images/logo.gif" align="absmiddle" border="0"></a></div>
    <span class="logoSpaceLink"><a href="../../../../index.html">Cayenne User Documentation</a></span><br />
    <span class="pagetitle">Command-Line Tutorial</span>
  </div>
<div id="cayenne_toc">
<ul>
<li><a href="../../../../Documentation/User Guide/Introduction/index.html">Introduction</a></li>
<li><a href="../../../../Documentation/User Guide/Installation/index.html">Installation</a></li>
<li><a href="../../../../Documentation/User Guide/Quick Start/index.html">Quick Start</a><ul>
<li><a href="../../../../Documentation/User Guide/Quick Start/Cayenne Application/index.html">Cayenne Application</a></li>
<li><a href="../../../../Documentation/User Guide/Quick Start/Command-Line Tutorial/index.html">Command-Line Tutorial</a><ul>
</ul>
</li>
<li><a href="../../../../Documentation/User Guide/Quick Start/Common Setup Steps/index.html">Common Setup Steps</a></li>
<li><a href="../../../../Documentation/User Guide/Quick Start/JSP-Struts Tutorial/index.html">JSP-Struts Tutorial</a></li>
<li><a href="../../../../Documentation/User Guide/Quick Start/Tapestry/index.html">Tapestry</a></li>
</ul>
</li>
<li><a href="../../../../Documentation/User Guide/Design/index.html">Design</a></li>
<li><a href="../../../../Documentation/User Guide/Generating Classes/index.html">Generating Classes</a></li>
<li><a href="../../../../Documentation/User Guide/DataContext/index.html">DataContext</a></li>
<li><a href="../../../../Documentation/User Guide/Queries/index.html">Queries</a></li>
<li><a href="../../../../Documentation/User Guide/DataObjects/index.html">DataObjects</a></li>
<li><a href="../../../../Documentation/User Guide/Stored Procedures/index.html">Stored Procedures</a></li>
<li><a href="../../../../Documentation/User Guide/Expressions/index.html">Expressions</a></li>
<li><a href="../../../../Documentation/User Guide/Performance Tuning/index.html">Performance Tuning</a></li>
<li><a href="../../../../Documentation/User Guide/Deployment/index.html">Deployment</a></li>
<li><a href="../../../../Documentation/User Guide/Ant Tasks/index.html">Ant Tasks</a></li>
<li><a href="../../../../Documentation/User Guide/Access Stack Internals/index.html">Access Stack Internals</a></li>
<li><a href="../../../../Documentation/User Guide/DataViews/index.html">DataViews</a></li>
</ul>
</div>
<div id="ConfluenceContent"><p>This is a simple command-line Cayenne application tutorial. Full tutorial source code is included in Cayenne distribution in "src/tutorials" folder.</p>

<h3><a name="Command-LineTutorial-PreparetheEnvironment"></a>Prepare the Environment</h3>

<p>Make sure you successfully finished <a href="../../../../Documentation/User Guide/Quick Start/Common Setup Steps/index.html" title="Common Setup Steps">common setup steps</a>.</p>

<p>Create a new folder named cayenne-cmd-app anywhere in the filesystem. This directory is referred to as "project directory" further in this chapter. Note that when you are finished going through all the steps below, project directory will become similar to this tutorial source folder distributed with Cayenne.</p>

<h3><a name="Command-LineTutorial-PrepareTutorialDatabase"></a>Prepare Tutorial Database<a name="Command-LineTutorial-PrepareTutorialDatabase"></a></h3>

<p>Run tutorialdb.sql script located in the project directory to create test tables. This script is tested on MySQL, but it should be easy to port to any other RDBMS.</p>

<h3><a name="Command-LineTutorial-SetupDataNode"></a>Setup DataNode<a name="Command-LineTutorial-SetupDataNode"></a></h3>

<p>The following configuration files make up a Cayenne project for this tutorial:</p>

<ul>
	<li>cayenne.xml</li>
	<li>datamap.map.xml</li>
	<li>driverinfo.driver.xml</li>
</ul>


<p>In this step we will change the default information stored in these files to point to your own database. Open cayenne.xml in CayenneModeler and perform the following operations.</p>

<ul>
	<li>On the left-hand side object tree click on an icon with title "datanode", a DataNode editor panel will open on the right.</li>
	<li>If the database you are planning to use is NOT MySQL, select an appropriate adapter from the "DB Adapter" dropdown list on the right.</li>
	<li>From the "Local DataSource" dropdown list select one of the local DataSources configured previously per "Common Setup Steps" instructions. After this is done, click "Sync with Local" button in the bottom right corner.</li>
	<li>Save the project by clicking "Save" button or selecting File -&gt; Save from the menu.</li>
</ul>



<h3><a name="Command-LineTutorial-SetupAutomaticPrimaryKeyGeneration"></a>Setup Automatic Primary Key Generation<a name="Command-LineTutorial-SetupAutomaticPrimaryKeyGeneration"></a></h3>

<p>This step is needed to allow Cayenne to generate primary keys automatically for the newly inserted objects. With project still open in the Modeler, select an icon titled "datamap" on the left, and go to Tools &gt; Generate Database Schema, then follow the steps outlined in the modeler guide to setup the database for <a href="../../../../Documentation/Modeler Guide/Common Modeling Tasks/Generate Primary Key Support/index.html" title="Generate Primary Key Support">primary key generation support</a>.</p>

<h3><a name="Command-LineTutorial-GenerateJavaCodeforDataObjects"></a>Generate Java Code for DataObjects<a name="Command-LineTutorial-GenerateJavaCodeforDataObjects"></a></h3>

<p>In this step we will generate persistent Java classes from the existing mapping information. Create "java" subdirectory in the project directory. It will contain generated classes. In CayenneModeler with "datamap" still selected, go to "Tools &gt; Generate Classes", select the newly created directory as an "Output Directory", and click "Generate" button.</p>

<p>After class generation is done, the following files should appear in the java/test and java/auto subdirectories of the project directory:</p>

<ul>
	<li>_Artist.java</li>
	<li>Artist.java</li>
	<li>_Painting.java</li>
	<li>Painting.java</li>
	<li>_Gallery.java</li>
	<li>Gallery.java</li>
</ul>



<h3><a name="Command-LineTutorial-ApplicationCode"></a>Application Code</h3>

<p>A simple application that uses Cayenne is located in Main.java. Copy the source file to the java/test project subdirectory.</p>

<h3><a name="Command-LineTutorial-CompileandRuntheApplication"></a>Compile and Run the Application</h3>

<p>Compile the source code (assume that JAVA_HOME variable points to the JSDK 1.4 installation). On Windows:</p>

<div class="preformatted"><div class="preformattedContent">
<pre>projectdir&gt; set CLASSPATH=%CLASSPATH%;%CAYENNE_HOME%\lib\cayenne.jar
projectdir&gt; %JAVA_HOME%\bin\javac java\test\*.java 
</pre>
</div></div>
<p>On UNIX:</p>
<div class="preformatted"><div class="preformattedContent">
<pre>projectdir# export CLASSPATH=$CLASSPATH:$CAYENNE_HOME/lib/cayenne.jar
projectdir# $JAVA_HOME/bin/javac java/test/*.java 
</pre>
</div></div>
<p>Main tutorial class is "test.Main". It takes a single parameter - a search word to look up a gallery by name. It will try to find a matching gallery, then create a new artist (Salvador Dali) with a single painting and add this painting to the found gallery. To run the tutorial do something like this (example given for Windows):</p>
<div class="preformatted"><div class="preformattedContent">
<pre>projectdir&gt; set CLASSPATH=%CLASSPATH%;java
projectdir&gt; %JAVA_HOME%\bin\java test.Main metro 
</pre>
</div></div>
<p>If there is a gallery matching search criteria (in our case "Metropolitan Museum of Art" would match the word "metro"), the following output will be printed:</p>
<div class="preformatted"><div class="preformattedContent">
<pre>WARN  QueryLogger: --- will run 1 query.
WARN  QueryLogger: SELECT t0.GALLERY_NAME, t0.GALLERY_ID 
FROM GALLERY t0 WHERE UPPER(t0.GALLERY_NAME) LIKE UPPER(?) 
[params: '%metro%'] - prepared in 20 ms.
WARN  QueryLogger: === returned 1 row. - took 0 ms.
</pre>
</div></div>
<p>Found gallery 'The Metropolitan Museum of Art'.</p>
<div class="preformatted"><div class="preformattedContent">
<pre>WARN  QueryLogger: --- will run 2 queries.
WARN  QueryLogger: INSERT INTO ARTIST (ARTIST_ID, DATE_OF_BIRTH, ARTIST_NAME) 
VALUES (?, ?, ?) [params: 320, NULL, 'Salvador Dali']
WARN  QueryLogger: === updated 1 row.
WARN  QueryLogger: INSERT INTO PAINTING (PAINTING_ID, ARTIST_ID, 
ESTIMATED_PRICE, PAINTING_TITLE) VALUES (?, ?, ?, ?) 
[params: 320, 320, NULL, 'Sleep']
WARN  QueryLogger: === updated 1 row.
WARN  QueryLogger: +++ transaction committed. 
</pre>
</div></div></div>
</div>
  <div class="clearer">.</div>
  <div style="height: 12px; background-image: url('../../../../images/border_bottom.gif'); background-repeat: repeat-x;"></div>

  <div class="smalltext copyright">
    Copyright &copy;2001-2006 ObjectStyle Group and content authors
  </div>

</body>
</html>
